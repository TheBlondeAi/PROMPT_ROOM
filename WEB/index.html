<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PROMPT_ROOM Dashboard</title>
  <link rel="stylesheet" href="styles/dashboard.css" />
</head>
<body>
  <main class="wrap">
    <h1>PROMPT_ROOM — Health</h1>
    <section class="card">
      <svg id="trend" viewBox="0 0 960 260" width="100%" height="260" role="img" aria-label="Failure trend" preserveAspectRatio="xMidYMid meet"></svg>
    </section>
  </main>

  <script type="module">
    import { TrendChart } from './dist/trend-chart.js';
    
    const svg = document.getElementById('trend');
    if (svg) {
      const chart = new TrendChart(svg, { responsive: true });

      // ункция для загрузки и отрисовки данных
      const loadData = async () => {
        try {
          // обавляем ?t=... чтобы сбросить кэш браузера
          const response = await fetch('../LOGS/health.json?t=' + new Date().getTime());
          if (!response.ok) return; // е падать, если файла еще нет
          
          const data = await response.json();
          if (data && data.points) {
            chart.render(data.points);
          }
        } catch (e) {
          console.error("Failed to load chart data", e);
        }
      };

      // 1. агружаем сразу
      loadData();
      
      // 2.  ставим "тикер" на каждые 10 секунд
      setInterval(loadData, 10000); // 10 000 мс = 10 секунд
    }
  </script>
</body>
</html>
